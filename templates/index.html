<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç†±å¤©å ‚ - é›²ç«¯ç­è¡¨ç€è¦½å™¨</title>
    <!-- å¼•å…¥ Tailwind CSS (ç¾åŒ–æ’ç‰ˆ) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        function appData() {
            return {
                isDemoMode: false,
                locations: [],
                currentLocation: null,
                people: [],
                currentPerson: null,
                content: { images: [], videos: [], text: { preview: '', full: '', has_doc: false } }, 
                textExpanded: false,
                modal: { open: false, type: '', url: '' },

                // æ¨¡æ“¬è³‡æ–™ (å·²æ›´æ–°ç‚ºæ”¯æ´å¡ç‰‡é¡¯ç¤ºçš„çµæ§‹)
                mockData: {
                    locations: ['(Demo) æ¡ƒåœ’', '(Demo) ä¸­å£¢', '(Demo) æ¿æ©‹'],
                    people: [
                        { name: '(Demo) ç†Šå¯¶è²', thumbnail: 'https://via.placeholder.com/400x600?text=Portrait', preview: 'é€™æ˜¯ç†Šå¯¶è²çš„ç°¡ä»‹ã€‚\nå¥¹éå¸¸æ´»æ½‘å¯æ„›ã€‚\né»æ“ŠæŸ¥çœ‹æ›´å¤šå…§å®¹...' },
                        { name: '(Demo) å°å¤©ä½¿', thumbnail: null, preview: 'é€™æ˜¯å°å¤©ä½¿çš„ç°¡ä»‹ã€‚\né€™è£¡åªæœ‰å…©è¡Œå­—ã€‚' },
                        { name: '(Demo) æ¸¬è©¦å“¡', thumbnail: 'https://via.placeholder.com/400x600?text=Test', preview: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦å¸³è™Ÿã€‚\næ²’æœ‰å¤ªå¤šå…§å®¹ã€‚\nä½†æ˜¯æœ‰ä¸‰è¡Œé è¦½ã€‚' }
                    ],
                    content: {
                        text: { 
                            has_doc: true, 
                            preview: 'é€™æ˜¯å…§é çš„è©³ç´°å…§å®¹...', 
                            full: 'é€™æ˜¯å…§é çš„è©³ç´°å…§å®¹...\né€™è£¡æœƒæœ‰å®Œæ•´çš„æ–‡ç« ã€‚' 
                        },
                        images: [
                            { name: 'Demo1.jpg', url: 'https://via.placeholder.com/300x300' }
                        ],
                        videos: []
                    }
                },

                async init() {
                    try {
                        const res = await fetch('/api/locations');
                        if (res.ok) {
                            this.locations = await res.json();
                            if (this.locations.length > 0) {
                                this.selectLocation(this.locations[0]);
                            }
                        } else {
                            throw new Error('API response not ok');
                        }
                    } catch (e) {
                        console.warn("ç„¡æ³•é€£æ¥å¾Œç«¯ï¼Œåˆ‡æ›è‡³æ¼”ç¤ºæ¨¡å¼:", e);
                        this.enableDemoMode();
                    }
                },

                enableDemoMode() {
                    this.isDemoMode = true;
                    this.locations = this.mockData.locations;
                    this.selectLocation(this.locations[0]);
                },

                async selectLocation(loc) {
                    this.currentLocation = loc;
                    this.currentPerson = null;
                    
                    if (this.isDemoMode) {
                        this.people = this.mockData.people;
                        return;
                    }

                    try {
                        const res = await fetch(`/api/people/${loc}`);
                        if (res.ok) {
                            this.people = await res.json();
                        }
                    } catch (e) {
                        console.error("è®€å–åœ°é»å¤±æ•—:", e);
                    }
                },

                async selectPerson(personObj) {
                    // å› ç‚ºç¾åœ¨ people æ˜¯ä¸€å€‹åŒ…å«è©³ç´°è³‡æ–™çš„ç‰©ä»¶ï¼Œæ‰€ä»¥è¦ç”¨ personObj.name
                    this.currentPerson = personObj.name;
                    this.textExpanded = false;
                    this.content = { images: [], videos: [], text: { preview: '', full: '', has_doc: false } };

                    if (this.isDemoMode) {
                        setTimeout(() => {
                            this.content = JSON.parse(JSON.stringify(this.mockData.content));
                        }, 200);
                        return;
                    }

                    try {
                        const res = await fetch(`/api/content/${this.currentLocation}/${this.currentPerson}`);
                        if (res.ok) {
                            this.content = await res.json();
                        }
                    } catch (e) {
                        console.error("è®€å–å…§å®¹å¤±æ•—:", e);
                    }
                },

                openModal(type, url) {
                    if (this.isDemoMode && type === 'video') {
                        alert("æ¼”ç¤ºæ¨¡å¼ä¸‹ç„¡æ³•æ’­æ”¾çœŸå¯¦å½±ç‰‡");
                        return;
                    }
                    this.modal.type = type;
                    this.modal.url = url;
                    this.modal.open = true;
                },

                closeModal() {
                    this.modal.open = false;
                    this.modal.url = '';
                }
            }
        }
    </script>

    <!-- å¼•å…¥ Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        /* é™åˆ¶é¡¯ç¤ºè¡Œæ•¸ï¼Œè¶…é3è¡Œé¡¯ç¤º ... */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans" x-data="appData()">

    <!-- æ¼”ç¤ºæ¨¡å¼è­¦å‘Šæ¢ -->
    <div x-show="isDemoMode" class="bg-yellow-100 border-b border-yellow-200 text-yellow-800 px-4 py-2 text-center text-sm">
        âš ï¸ ç›®å‰ç‚º <b>æ¼”ç¤ºæ¨¡å¼ (Demo Mode)</b>ï¼Œè«‹åœ¨é›»è…¦ä¸ŠåŸ·è¡Œ <code>python app.py</code> ä»¥è®€å–çœŸå¯¦æª”æ¡ˆã€‚
    </div>

    <!-- é ‚éƒ¨å°èˆªæ¬„ (åœ°é») -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex-shrink-0 flex items-center">
                    <h1 class="text-xl font-bold text-indigo-600">ğŸ“‚ æƒ…ç†±å¤©å ‚è³‡æ–™åº«</h1>
                </div>
                <!-- åœ°é»é¸å–® -->
                <div class="flex space-x-4 overflow-x-auto pb-2 sm:pb-0">
                    <template x-for="loc in locations" :key="loc">
                        <button 
                            @click="selectLocation(loc)"
                            :class="currentLocation === loc ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-200'"
                            class="px-3 py-2 rounded-md text-sm font-medium transition duration-150 whitespace-nowrap"
                            x-text="loc">
                        </button>
                    </template>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        
        <!-- å¦‚æœé‚„æ²’é¸åœ°é» -->
        <div x-show="!currentLocation" class="text-center py-20 text-gray-500">
            <p class="text-2xl">è«‹é¸æ“‡ä¸Šæ–¹çš„ä¸€å€‹åœ°é»</p>
        </div>

        <!-- äººå“¡åˆ—è¡¨å€ (Grid æ’ç‰ˆæ›´æ–°) -->
        <div x-show="currentLocation && !currentPerson" class="px-4">
            <h2 class="text-lg font-semibold mb-4 text-gray-700">ğŸ“ <span x-text="currentLocation"></span> çš„äººå“¡åˆ—è¡¨</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <template x-for="person in people" :key="person.name">
                    <div @click="selectPerson(person)" 
                         class="bg-white rounded-lg shadow-md hover:shadow-xl cursor-pointer transform hover:-translate-y-1 transition duration-200 overflow-hidden border border-gray-200 flex flex-col h-full">
                        
                        <!-- ä¸Šæ–¹ï¼šåœ–ç‰‡å€åŸŸ (é«˜åº¦èª¿æ•´ç‚º h-96, ç´„ 384px) -->
                        <div class="h-96 bg-gray-200 w-full relative">
                            <template x-if="person.thumbnail">
                                <!-- åŠ å…¥ object-top å„ªå…ˆé¡¯ç¤ºä¸Šæ–¹(è‡‰éƒ¨) -->
                                <img :src="person.thumbnail" class="w-full h-full object-cover object-top">
                            </template>
                            <template x-if="!person.thumbnail">
                                <div class="w-full h-full flex flex-col items-center justify-center text-gray-400 bg-gray-100">
                                    <span class="text-5xl mb-2">ğŸ‘¤</span>
                                    <span class="text-xs">ç„¡å°é¢ç…§ç‰‡</span>
                                </div>
                            </template>
                        </div>

                        <!-- ä¸‹æ–¹ï¼šæ–‡å­—å€åŸŸ -->
                        <div class="p-4 flex flex-col flex-grow">
                            <h3 class="text-xl font-bold text-gray-900 mb-2" x-text="person.name"></h3>
                            <div class="text-sm text-gray-600 flex-grow">
                                <p class="whitespace-pre-line line-clamp-3" x-text="person.preview || 'å°šç„¡æ–‡å­—ç°¡ä»‹'"></p>
                            </div>
                            <div class="mt-4 pt-3 border-t border-gray-100">
                                <span class="text-indigo-600 text-sm font-medium hover:underline">æŸ¥çœ‹è©³ç´°å…§å®¹ &rarr;</span>
                            </div>
                        </div>

                    </div>
                </template>
            </div>

            <!-- ç©ºç‹€æ…‹ -->
            <div x-show="people.length === 0" class="text-center text-gray-400 py-20">
                æ­¤åœ°é»è³‡æ–™å¤¾å…§æ²’æœ‰äººå“¡è³‡æ–™
            </div>
        </div>

        <!-- äººå“¡è©³ç´°å…§å®¹å€ -->
        <div x-show="currentPerson" class="px-4">
            <!-- éºµåŒ…å±‘å°èˆª -->
            <button @click="currentPerson = null" class="mb-4 text-indigo-600 hover:text-indigo-800 flex items-center font-medium">
                &larr; è¿”å› <span x-text="currentLocation" class="mx-1 font-bold"></span> åˆ—è¡¨
            </button>

            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">
                ğŸ‘¤ <span x-text="currentPerson"></span>
            </h2>

            <!-- æ–‡å­—å…§å®¹ (.docx) -->
            <div x-show="content.text.has_doc" class="bg-white rounded-lg shadow p-6 mb-8 border-l-4 border-indigo-500">
                <h3 class="text-lg font-semibold mb-3 text-gray-700">ğŸ“„ æ–‡æª”å…§å®¹</h3>
                <div class="text-gray-600 whitespace-pre-line leading-relaxed">
                    <!-- é è¦½æ¨¡å¼ -->
                    <div x-show="!textExpanded">
                        <span x-text="content.text.preview"></span>
                        <span x-show="content.text.full.length > content.text.preview.length" class="text-gray-400">...</span>
                    </div>
                    <!-- å®Œæ•´æ¨¡å¼ -->
                    <div x-show="textExpanded" x-text="content.text.full" x-transition></div>
                </div>
                <button 
                    x-show="content.text.full.length > content.text.preview.length"
                    @click="textExpanded = !textExpanded" 
                    class="mt-3 text-sm text-indigo-600 hover:underline focus:outline-none">
                    <span x-text="textExpanded ? 'æ”¶èµ·å…§å®¹' : 'é–±è®€æ›´å¤š...'"></span>
                </button>
            </div>

            <!-- ç…§ç‰‡èˆ‡å½±ç‰‡ç¶²æ ¼ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- å½±ç‰‡ -->
                <template x-for="vid in content.videos" :key="vid.name">
                    <div class="group relative aspect-video bg-black rounded-lg overflow-hidden shadow-md cursor-pointer"
                         @click="openModal('video', vid.url)">
                        <video :src="vid.url" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition"></video>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="bg-white/30 rounded-full p-3 group-hover:bg-white/50 transition">â–¶ï¸</span>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                            <p class="text-white text-xs truncate" x-text="vid.name"></p>
                        </div>
                    </div>
                </template>

                <!-- ç…§ç‰‡ -->
                <template x-for="img in content.images" :key="img.name">
                    <div class="group relative aspect-square bg-gray-200 rounded-lg overflow-hidden shadow-md cursor-pointer"
                         @click="openModal('image', img.url)">
                        <img :src="img.url" class="w-full h-full object-cover group-hover:scale-105 transition duration-300">
                        <div class="absolute bottom-0 left-0 right-0 bg-black/50 p-2 opacity-0 group-hover:opacity-100 transition">
                            <p class="text-white text-xs truncate" x-text="img.name"></p>
                        </div>
                    </div>
                </template>
            </div>
            
            <div x-show="content.images.length === 0 && content.videos.length === 0 && !content.text.has_doc" class="text-center py-10 text-gray-400">
                æ­¤è³‡æ–™å¤¾å…§æ²’æœ‰åª’é«”æª”æ¡ˆ
            </div>
        </div>
    </main>

    <!-- ç‡ˆç®± Modal (å…¨è¢å¹•é è¦½) -->
    <div x-show="modal.open" 
         x-transition.opacity
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4"
         style="display: none;">
        
        <!-- é—œé–‰æŒ‰éˆ• -->
        <button @click="closeModal()" class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300">&times;</button>

        <!-- å…§å®¹å®¹å™¨ -->
        <div class="max-w-5xl max-h-full w-full flex items-center justify-center" @click.outside="closeModal()">
            <img x-show="modal.type === 'image'" :src="modal.url" class="max-h-[85vh] max-w-full rounded shadow-2xl">
            <video x-show="modal.type === 'video'" :src="modal.url" controls autoplay class="max-h-[85vh] max-w-full rounded shadow-2xl"></video>
        </div>
    </div>
</body>
</html>