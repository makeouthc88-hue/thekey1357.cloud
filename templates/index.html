<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç†±å¤©å ‚ - é›²ç«¯ç­è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans" x-data="appData()">

    <header class="bg-white shadow sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <h1 class="text-xl font-bold text-indigo-600 cursor-pointer" @click="reset()">ğŸ“‚ æƒ…ç†±å¤©å ‚è³‡æ–™åº«</h1>
            <div class="flex space-x-2 overflow-x-auto">
                <template x-for="loc in locations" :key="loc">
                    <button @click="selectLocation(loc)" 
                            :class="currentLocation === loc ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-200'"
                            class="px-3 py-1 rounded text-sm transition whitespace-nowrap" x-text="loc"></button>
                </template>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-6 px-4">
        <div x-show="!currentLocation" class="text-center py-20 text-gray-500">
            <p class="text-2xl">è«‹é»é¸ä¸Šæ–¹çš„åœ°é»ä»¥é–‹å§‹ç€è¦½</p>
        </div>

        <div x-show="currentLocation && !currentPerson" x-cloak>
            <h2 class="text-lg font-bold mb-4 text-gray-700">ğŸ“ <span x-text="currentLocation"></span> äººå“¡åˆ—è¡¨</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <template x-for="p in people" :key="p.name">
                    <div @click="selectPerson(p)" class="bg-white rounded shadow hover:shadow-lg cursor-pointer transition flex flex-col overflow-hidden">
                        <div class="h-80 bg-gray-200 relative">
                            <img x-show="p.thumbnail" :src="p.thumbnail" class="w-full h-full object-cover object-top">
                            <div x-show="!p.thumbnail" class="w-full h-full flex items-center justify-center text-gray-400">ç„¡ç…§ç‰‡</div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-bold text-lg" x-text="p.name"></h3>
                            <p class="text-sm text-gray-600 mt-2 whitespace-pre-line line-clamp-3" x-text="p.preview"></p>
                        </div>
                    </div>
                </template>
            </div>
            <div x-show="people.length === 0" class="text-center text-gray-400 py-10">æ­¤åœ°é»ç„¡è³‡æ–™</div>
        </div>

        <div x-show="currentPerson" x-cloak>
            <button @click="currentPerson = null" class="mb-4 text-indigo-600 hover:underline">â† è¿”å›åˆ—è¡¨</button>
            <h2 class="text-2xl font-bold mb-6">ğŸ‘¤ <span x-text="currentPerson"></span></h2>

            <div x-show="content.text.has_doc" class="bg-white p-6 rounded shadow mb-8 border-l-4 border-indigo-500">
                <div class="whitespace-pre-line text-gray-700 leading-relaxed">
                    <span x-show="!textExpanded" x-text="content.text.preview + '...'"></span>
                    <span x-show="textExpanded" x-text="content.text.full"></span>
                </div>
                <button @click="textExpanded = !textExpanded" class="mt-2 text-indigo-600 text-sm" x-text="textExpanded ? 'æ”¶èµ·' : 'é–±è®€å…¨æ–‡'"></button>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <template x-for="vid in content.videos">
                    <div class="aspect-video bg-black rounded overflow-hidden relative group cursor-pointer" @click="openModal('video', vid.url)">
                        <video :src="vid.url" class="w-full h-full object-cover opacity-80"></video>
                        <div class="absolute inset-0 flex items-center justify-center text-white text-3xl">â–¶ï¸</div>
                    </div>
                </template>
                <template x-for="img in content.images">
                    <div class="aspect-square bg-gray-200 rounded overflow-hidden cursor-pointer" @click="openModal('image', img.url)">
                        <img :src="img.url" class="w-full h-full object-cover hover:scale-105 transition">
                    </div>
                </template>
            </div>
        </div>
    </main>

    <div x-show="modal.open" class="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4" x-cloak @click.self="closeModal()">
        <button @click="closeModal()" class="absolute top-5 right-5 text-white text-4xl">&times;</button>
        <img x-show="modal.type === 'image'" :src="modal.url" class="max-h-[90vh] max-w-full rounded">
        <video x-show="modal.type === 'video'" :src="modal.url" controls autoplay class="max-h-[90vh] max-w-full rounded"></video>
    </div>

    <script>
        function appData() {
            return {
                locations: [], currentLocation: null,
                people: [], currentPerson: null,
                content: { text: {}, images: [], videos: [] },
                textExpanded: false, modal: { open: false, type: '', url: '' },

                async init() {
                    const res = await fetch('/api/locations');
                    this.locations = await res.json();
                },
                async selectLocation(loc) {
                    this.currentLocation = loc; this.currentPerson = null;
                    const res = await fetch(`/api/people/${loc}`);
                    this.people = await res.json();
                },
                async selectPerson(p) {
                    this.currentPerson = p.name; this.textExpanded = false;
                    const res = await fetch(`/api/content/${this.currentLocation}/${p.name}`);
                    this.content = await res.json();
                },
                openModal(type, url) { this.modal = { open: true, type, url }; },
                closeModal() { this.modal.open = false; this.modal.url = ''; },
                reset() { this.currentLocation = null; this.currentPerson = null; }
            }
        }
    </script>
</body>
</html>